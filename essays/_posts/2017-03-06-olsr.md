---
layout: post
title: OLSR debuggen
language: de
---


Ich debugge gerade, warum olsr ncht auf meinem Router läuft.
Das erste, was ich feststelle, wenn ich SmartGateway ausschalte:

```
root@254-150-heinrich-von-kleist:~# /etc/init.d/olsrd start
olsrd: /etc/init.d/olsrd: olsrd_write_loadplugin() Warning: Plugin library 'olsrd_txtinfo.so.0.1' not found, skipped
olsrd: /etc/init.d/olsrd: olsrd_write_loadplugin() Warning: Plugin library 'olsrd_watchdog.so.0.1' not found, skipped
olsrd: /etc/init.d/olsrd: startup-error: check via: '/usr/sbin/olsrd -f "/var/etc/olsrd.conf" -nofork'
```

ich bekomme die Möglichkeit, den "olsr log file" bzw. den Output von OLSR zu sehen,
wenn ich es so starte:

```
/usr/sbin/olsrd -f "/var/etc/olsrd.conf" -nofork
```

Vorher habe ich es so gestartet:

```
/etc/init.d/olsrd start
```

Nach einer Weile verschwindet der Prozess.

Das Problem ist, dass eine Assertion failed:
```
/usr/sbin/olsrd -f "/var/etc/olsrd.conf" -nofork
[...]
Assertion failed: multi_gateway_mode() (src/gateway.c: doRoutesMultiGw: 2371)
```
[Volles Log][issue]

Google nach "olsr source code".
Dann finde ich den Code, der das Problem veursacht:

```
assert(multi_gateway_mode());
```
[Quelle](https://github.com/OLSR/olsrd/blob/master/src/gateway.c#L2380)

```
static INLINE bool multi_gateway_mode(void) {
  return (olsr_cnf->smart_gw_use_count > 1);
}
```
[Quelle](https://github.com/OLSR/olsrd/blob/9055710306714b9a363b89c20b7451c74dbd46ce/src/gateway.h#L67)

```
struct olsrd_config {
[...]
  uint8_t smart_gw_use_count;
[...]
}
```
[Quelle](https://github.com/OLSR/olsrd/blob/9055710306714b9a363b89c20b7451c74dbd46ce/src/olsr_cfg.h#L329)

```
olsr_cnf->smart_gw_use_count = $2->integer;
```
[Quelle: Parser](https://github.com/OLSR/olsrd/blob/9055710306714b9a363b89c20b7451c74dbd46ce/src/cfgparser/oparse.y#L1360)

Ich kann schlussfolgern, dass der Wert in der Konfiguration gesetzt wird. 

Ich habe eine [Issue geöffnet][issue], da Assertions eigendlich nicht auftreten dürfen.
Darin wird empfohlen, [Version 0.9.6.1](https://github.com/OLSR/olsrd/tree/v0.9.6.1) von olsrd zu benutzen.
Ich benutze 0.9.5.
Dafür compile ich die Freifunkfirmware selbst.
In [firmware](https://github.com/freifunk-berlin/firmware)/lede/feeds/routing/olsrd/Makefile
steht nach dem ersten anstoßen von `make` die olsrd configuration.
Diese kann ich ändern, indem ich 0.9.5 durch 0.9.6.1 ersetze:

```
PKG_VERSION:=0.9.6.1
PKG_RELEASE=$(PKG_SOURCE_VERSION)

PKG_SOURCE_PROTO:=git
PKG_SOURCE_URL:=https://github.com/OLSR/olsrd.git
PKG_SOURCE_SUBDIR:=$(PKG_NAME)-$(PKG_VERSION)
PKG_SOURCE_VERSION:=v0.9.6.1
PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION)-$(PKG_SOURCE_VERSION).tar.gz
```





[issue]: https://github.com/OLSR/olsrd/issues/21